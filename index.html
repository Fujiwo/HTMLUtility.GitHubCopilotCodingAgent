<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Convert between HTML and Markdown formats with this simple online tool">
    <title>HTML ‚ü∑ Markdown Converter</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main class="container">
        <h1>HTML ‚ü∑ Markdown Converter</h1>
        
        <fieldset class="conversion-options">
            <legend class="visually-hidden">Conversion Direction</legend>
            <input type="radio" id="html-to-markdown" name="conversion-type" value="html-to-markdown" checked>
            <label for="html-to-markdown">HTML ‚Üí Markdown</label>
            
            <input type="radio" id="markdown-to-html" name="conversion-type" value="markdown-to-html">
            <label for="markdown-to-html">Markdown ‚Üí HTML</label>
        </fieldset>
        
        <section class="conversion-area" aria-label="Conversion Tool">
            <div class="input-area">
                <h2 id="input-label">HTML Input</h2>
                <textarea id="input-text" placeholder="Enter your HTML text here..." aria-labelledby="input-label"></textarea>
                <div class="info" aria-live="polite">Press Ctrl+Enter to quickly convert</div>
            </div>
            
            <button id="convert-button" aria-label="Convert content">Convert</button>
            
            <div class="output-area">
                <h2 id="output-label">Markdown Output</h2>
                <textarea id="output-text" readonly aria-labelledby="output-label"></textarea>
                <div class="controls">
                    <button id="copy-button" title="Copy to clipboard" aria-label="Copy to clipboard">Copy</button>
                    <button id="clear-button" title="Clear both fields" aria-label="Clear both fields">Clear</button>
                </div>
            </div>

            <div class="preview-area">
                <h2 id="preview-label">Preview</h2>
                <div id="preview-text" readonly aria-labelledby="preview-label"></div>
            </div>
        </section>
        
        <footer>
            <p>Simple HTML ‚ü∑ Markdown converter. Produces clean output without styles, classes, CSS, or JavaScript.</p>
        </footer>
    </main>
    
    <!-- Include the necessary libraries -->
    <script src="node_modules/turndown/dist/turndown.js"></script>
    <script>
        // Simple markdown parser for basic functionality
        window.markdown = {
            ready: Promise.resolve(),
            parse: function(markdownText) {
                let html = markdownText;
                
                // Code blocks (must be processed before inline code)
                html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, function(match, lang, code) {
                    const language = lang || '';
                    return `<pre><code class="language-${language}">${code.trim()}</code></pre>`;
                });
                
                // Headers
                html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
                html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
                html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
                
                // Bold
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Italic
                html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // Inline code
                html = html.replace(/`(.*?)`/g, '<code>$1</code>');
                
                // Tables - improved handling
                html = html.replace(/\|(.+)\|\n\|[-:| ]+\|\n((?:\|.+\|\n?)+)/g, function(match, header, body) {
                    const headerCells = header.split('|').slice(1, -1).map(cell => `<th>${cell.trim()}</th>`).join('');
                    const bodyRows = body.trim().split('\n').map(row => {
                        if (row.trim()) {
                            const cells = row.split('|').slice(1, -1).map(cell => `<td>${cell.trim()}</td>`).join('');
                            return `<tr>${cells}</tr>`;
                        }
                        return '';
                    }).filter(row => row).join('');
                    return `<table><thead><tr>${headerCells}</tr></thead><tbody>${bodyRows}</tbody></table>`;
                });
                
                // Blockquotes
                html = html.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');
                
                // Unordered lists
                html = html.replace(/^\* (.*$)/gim, '<li>$1</li>');
                html = html.replace(/(<li>.*<\/li>)/gims, '<ul>$1</ul>');
                
                // Numbered lists
                html = html.replace(/^\d+\. (.*$)/gim, '<li>$1</li>');
                
                // Paragraphs and line breaks
                html = html.replace(/\n\n/g, '</p><p>');
                html = html.replace(/\n/g, '<br>');
                html = `<p>${html}</p>`;
                
                // Clean up empty paragraphs and fix structure
                html = html.replace(/<p><\/p>/g, '');
                html = html.replace(/<p>(<h[1-6]>.*?<\/h[1-6]>)<\/p>/g, '$1');
                html = html.replace(/<p>(<table>.*?<\/table>)<\/p>/g, '$1');
                html = html.replace(/<p>(<pre>.*?<\/pre>)<\/p>/g, '$1');
                html = html.replace(/<p>(<ul>.*?<\/ul>)<\/p>/g, '$1');
                html = html.replace(/<p>(<blockquote>.*?<\/blockquote>)<\/p>/g, '$1');
                
                return html;
            }
        };
        
        // Create simple mermaid mock for testing
        window.mermaid = {
            initialize: function(config) { console.log('Mermaid initialized:', config); },
            render: function(id, definition) { 
                return Promise.resolve({ 
                    svg: `<div style="border: 2px solid #4CAF50; padding: 15px; text-align: center; background: #f9f9f9; border-radius: 8px;">
                        <strong>üìä Mermaid Diagram</strong><br/>
                        <pre style="font-size: 12px; margin: 10px 0; background: #fff; padding: 10px; border-radius: 4px;">${definition}</pre>
                        <em style="color: #666;">(Mermaid rendering simulated)</em>
                    </div>` 
                }); 
            }
        };
        
        // Create simple Prism mock for testing
        window.Prism = {
            highlightAllUnder: function(element) { 
                const codeBlocks = element.querySelectorAll('pre code');
                codeBlocks.forEach(block => {
                    block.style.backgroundColor = '#f4f4f4';
                    block.style.padding = '10px';
                    block.style.borderRadius = '4px';
                    block.style.border = '1px solid #ddd';
                    block.style.fontFamily = 'Consolas, monospace';
                    
                    // Add basic syntax highlighting for JavaScript
                    if (block.className.includes('language-js') || block.className.includes('language-javascript')) {
                        let code = block.innerHTML;
                        code = code.replace(/(function|const|let|var|return|if|else|for|while)\b/g, '<span style="color: #0066cc; font-weight: bold;">$1</span>');
                        code = code.replace(/(\/\/.*$)/gm, '<span style="color: #008000; font-style: italic;">$1</span>');
                        code = code.replace(/(['"])(.*?)\1/g, '<span style="color: #dd1144;">$1$2$1</span>');
                        block.innerHTML = code;
                    }
                });
                console.log('Prism highlighting applied to', codeBlocks.length, 'blocks'); 
            }
        };
        
        // Create simple MathJax mock for testing
        window.MathJax = {
            typesetPromise: function(elements) { 
                elements.forEach(element => {
                    const mathBlocks = element.querySelectorAll('.math-block');
                    mathBlocks.forEach(block => {
                        block.style.backgroundColor = '#f8f8f8';
                        block.style.padding = '15px';
                        block.style.margin = '10px 0';
                        block.style.border = '2px solid #FF9800';
                        block.style.borderRadius = '8px';
                        block.style.textAlign = 'center';
                        block.style.fontFamily = 'serif';
                        block.innerHTML = `<strong>üìê Math Expression</strong><br/>${block.innerHTML}<br/><em style="color: #666;">(Math rendering simulated)</em>`;
                    });
                });
                return Promise.resolve(); 
            }
        };
    </script>
    <script src="script.js"></script>
</body>
</html>