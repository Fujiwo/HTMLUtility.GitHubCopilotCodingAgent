<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Marked Integration</title>
</head>
<body>
    <h1>Testing Marked Integration</h1>
    <div id="test-area">
        <h2>Test Input</h2>
        <textarea id="markdown-input" rows="10" cols="50"># Test Header

This is **bold** and *italic* text.

## Code Block
```js
console.log('Hello World');
```

## Mermaid Block
```mermaid
graph TD
A --> B
```

## Math Block  
```math
x = y + z
```</textarea>
        <br><br>
        <button onclick="convertTest()">Convert</button>
        <h2>Output</h2>
        <div id="output" style="border: 1px solid #ccc; padding: 10px; min-height: 200px;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Process mermaid and math blocks according to conversion rules
        const processSpecialBlocks = (markdownText) => {
            // Rule 1: Convert ```mermaid\n(content)\n``` to <pre class="mermaid">(content)</pre>
            markdownText = markdownText.replace(/```mermaid\n([\s\S]*?)\n```/g, (match, content) => {
                console.log('Processing mermaid block');
                return `<pre class="mermaid">${content}</pre>`;
            });
            
            // Rule 2: Convert ```math\n(content)\n``` to <math>(content)</math>
            markdownText = markdownText.replace(/```math\n([\s\S]*?)\n```/g, (match, content) => {
                console.log('Processing math block');
                return `<math>${content}</math>`;
            });
            
            return markdownText;
        };

        function convertTest() {
            const input = document.getElementById('markdown-input').value;
            const output = document.getElementById('output');
            
            try {
                if (typeof marked !== 'undefined' && marked.parse) {
                    const processedMarkdown = processSpecialBlocks(input);
                    const html = marked.parse(processedMarkdown);
                    output.innerHTML = html;
                    console.log('Conversion successful using marked');
                } else {
                    output.innerHTML = '<p style="color: red;">Marked library not loaded!</p>';
                    console.error('Marked library not available');
                }
            } catch (error) {
                output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                console.error('Conversion error:', error);
            }
        }

        // Test on page load
        window.onload = function() {
            if (typeof marked !== 'undefined') {
                console.log('Marked library loaded successfully!');
                convertTest(); // Auto-convert on load
            } else {
                console.error('Marked library failed to load');
            }
        };
    </script>
</body>
</html>